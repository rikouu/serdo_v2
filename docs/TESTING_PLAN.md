# Serdo 功能测试方案

本文档提供完整的功能测试计划，用于验证系统各模块的正确性。

---

## 📋 测试环境准备

### 1. 启动后端服务

```bash
cd api
AUTH_SECRET=test_secret_change_me CORS_ORIGIN=http://localhost:3000 REDACT_MODE=true node server.js
```

### 2. 启动前端服务

```bash
# 在项目根目录
VITE_API_BASE_URL=http://localhost:4000/api/v1 npm run dev
```

### 3. 测试账号
- 管理员：`admin` / `admin`（首次启动自动创建）
- 或通过注册功能创建新账号

---

## 🔐 认证系统测试

### 测试 1.1：用户注册
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 访问注册页面 | 显示注册表单 |
| 2 | 输入用户名、邮箱、密码 | 表单可填写 |
| 3 | 点击注册按钮 | 注册成功，自动登录并跳转到仪表盘 |
| 4 | 刷新页面 | 保持登录状态 |
| 5 | 关闭浏览器重新打开 | 保持登录状态 |

### 测试 1.2：用户登录
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 访问登录页面 | 显示登录表单 |
| 2 | 输入正确的用户名和密码 | 登录成功，跳转到仪表盘 |
| 3 | 输入错误的密码 | 显示"用户名或密码错误" |
| 4 | 尝试空表单提交 | 显示验证错误 |

### 测试 1.3：会话持久化
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 登录后打开开发者工具 | 检查 localStorage 中存在 `serdo_auth_token` |
| 2 | 刷新页面 | 保持登录状态，数据正常加载 |
| 3 | 新标签页打开应用 | 自动保持登录状态 |
| 4 | 等待 Token 过期（需修改后端 JWT 过期时间测试）| 自动登出，提示重新登录 |

### 测试 1.4：登出功能
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击登出按钮 | 跳转到登录页 |
| 2 | 检查 localStorage | `serdo_auth_token` 已清除 |
| 3 | 直接访问需登录的页面 | 重定向到登录页 |

---

## 🖥️ 服务器管理测试

### 测试 2.1：创建服务器
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击"添加服务器" | 显示服务器表单 |
| 2 | 填写必要信息（名称、IP、系统等）| 表单验证通过 |
| 3 | 填写面板密码 | 密码字段显示掩码 |
| 4 | 点击保存 | 服务器添加成功，列表更新 |

### 测试 2.2：编辑服务器
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击服务器的编辑按钮 | 显示编辑表单，数据预填充 |
| 2 | 修改服务器名称 | 表单更新 |
| 3 | 不修改密码字段 | 保存后密码保持不变 |
| 4 | 点击保存 | 更新成功，列表刷新 |

### 测试 2.3：删除服务器
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击服务器的删除按钮 | 显示确认对话框 |
| 2 | 确认删除 | 服务器从列表移除 |

### 测试 2.4：密码查看/复制（REDACT_MODE=true）
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 服务器详情中，密码显示为 `••••••••` | 密码已脱敏 |
| 2 | 点击"眼睛"图标 | 密码明文显示 |
| 3 | 再次点击"眼睛"图标 | 密码重新隐藏 |
| 4 | 点击"复制"图标 | 密码复制到剪贴板，显示成功提示 |

### 测试 2.5：Ping 检测
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击服务器的 Ping 按钮 | 显示加载状态 |
| 2 | 等待结果 | 显示延迟（毫秒）或"不可达" |

---

## 🌐 域名管理测试

### 测试 3.1：创建域名
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击"添加域名" | 显示域名表单 |
| 2 | 填写域名名称、注册商等 | 表单验证通过 |
| 3 | 点击保存 | 域名添加成功 |

### 测试 3.2：WHOIS 同步
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 配置系统设置中的 WHOIS API | 设置保存成功 |
| 2 | 点击域名的"同步"按钮 | 显示加载状态 |
| 3 | 等待结果 | 域名到期时间自动更新 |

---

## 🏢 服务商管理测试

### 测试 4.1：创建服务商
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击"添加服务商" | 显示服务商表单 |
| 2 | 填写名称、登录URL、账号密码 | 表单验证通过 |
| 3 | 点击保存 | 服务商添加成功 |

### 测试 4.2：密码查看/复制
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 服务商详情中，密码显示为 `••••••••` | 密码已脱敏 |
| 2 | 点击"眼睛"图标 | 密码明文显示 |
| 3 | 点击"复制"图标 | 密码复制成功 |

---

## ⚙️ 系统设置测试

### 测试 5.1：DNS 设置
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 打开系统设置 | 设置页面正常显示 |
| 2 | 修改 DNS 提供商 | 选择保存 |
| 3 | 刷新页面 | 设置已保存 |

### 测试 5.2：通知设置（SMTP）
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 启用 SMTP 通知 | 显示配置表单 |
| 2 | 填写 SMTP 配置 | 表单验证通过 |
| 3 | 点击"发送测试邮件" | 测试邮件发送成功 |

### 测试 5.3：自动检查设置
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 启用服务器自动检查 | 开关打开 |
| 2 | 设置检查间隔 | 保存成功 |
| 3 | 点击"立即检查" | 执行检查，显示结果 |

---

## 👤 用户资料测试

### 测试 6.1：修改邮箱
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 打开用户资料页 | 显示当前邮箱 |
| 2 | 修改邮箱，输入当前密码 | 表单验证通过 |
| 3 | 点击保存 | 邮箱更新成功 |

### 测试 6.2：修改密码
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 输入当前密码 | 字段填写 |
| 2 | 输入新密码和确认密码 | 密码匹配验证通过 |
| 3 | 点击保存 | 密码更新成功，自动重新登录 |
| 4 | 使用新密码登录 | 登录成功 |

### 测试 6.3：数据导出/导入
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击"导出数据" | 显示 JSON 数据 |
| 2 | 复制导出的 JSON | 复制成功 |
| 3 | 创建新账号，粘贴并导入 | 数据导入成功 |

---

## 🔧 管理员功能测试（admin 用户）

### 测试 7.1：邀请码管理
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 打开管理员页面 | 显示邀请码管理 |
| 2 | 生成邀请码 | 邀请码生成成功 |
| 3 | 使用邀请码注册新用户 | 注册成功 |

### 测试 7.2：用户管理
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 查看用户列表 | 显示所有用户 |
| 2 | 修改用户过期时间 | 保存成功 |
| 3 | 删除用户 | 用户删除成功 |

---

## 🖥️ WebSSH 测试

### 测试 8.1：连接 SSH
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 添加带有 SSH 信息的服务器 | 服务器添加成功 |
| 2 | 点击 SSH 图标 | 打开 WebSSH 终端 |
| 3 | 等待连接 | 显示"Connected"或连接状态 |
| 4 | 执行简单命令（如 `ls`）| 命令输出正常显示 |

---

## 📱 响应式测试

### 测试 9.1：移动端布局
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 使用开发者工具切换到移动视口 | 页面自适应 |
| 2 | 侧边栏应变为汉堡菜单 | 菜单可正常展开/收起 |
| 3 | 各功能在移动端可正常使用 | 无布局错乱 |

---

## 🔒 安全测试

### 测试 10.1：未授权访问
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 清除 localStorage 中的 token | Token 已清除 |
| 2 | 直接访问 API（如 `/api/v1/servers`）| 返回 401 |
| 3 | 尝试访问管理员 API（非 admin 用户）| 返回 403 |

### 测试 10.2：REDACT_MODE 验证
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 设置后端 `REDACT_MODE=true` | 重启后端 |
| 2 | 通过 API 获取服务器列表 | 密码字段为空，`hasPassword: true` |
| 3 | 调用 reveal API 获取密码 | 返回加密的密码数据 |

---

## 🐛 边界情况测试

### 测试 11.1：空数据状态
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 创建新用户 | 无服务器/域名/服务商 |
| 2 | 查看仪表盘 | 显示空状态引导 |
| 3 | 查看各列表页 | 显示"无数据"提示 |

### 测试 11.2：网络错误处理
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 停止后端服务 | 后端不可用 |
| 2 | 执行任意操作 | 显示"网络连接失败"提示 |

### 测试 11.3：并发操作
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 快速连续点击保存按钮 | 只执行一次保存 |
| 2 | 同时在两个标签页操作同一数据 | 后保存的覆盖先保存的 |

---

## ✅ 测试完成检查清单

- [ ] 所有认证流程测试通过
- [ ] 服务器 CRUD 功能正常
- [ ] 域名 CRUD 功能正常
- [ ] 服务商 CRUD 功能正常
- [ ] 密码查看/复制功能正常（REDACT_MODE）
- [ ] 系统设置保存正常
- [ ] 通知功能正常（SMTP 测试）
- [ ] 用户资料修改正常
- [ ] 管理员功能正常
- [ ] WebSSH 连接正常
- [ ] 响应式布局正常
- [ ] 安全机制验证通过
- [ ] 边界情况处理正常

---

## 📝 测试报告模板

```markdown
# Serdo 测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: 
**测试环境**: 
  - 前端版本: 
  - 后端版本: 
  - 浏览器: 
  - Node.js 版本: 

## 测试结果汇总

| 模块 | 测试用例数 | 通过 | 失败 | 跳过 |
|------|-----------|------|------|------|
| 认证系统 | | | | |
| 服务器管理 | | | | |
| 域名管理 | | | | |
| 服务商管理 | | | | |
| 系统设置 | | | | |
| 用户资料 | | | | |
| 管理员功能 | | | | |
| WebSSH | | | | |
| 响应式 | | | | |
| 安全测试 | | | | |

## 发现的问题

| 编号 | 模块 | 问题描述 | 严重程度 | 状态 |
|------|------|---------|---------|------|
| 1 | | | | |

## 备注

```

---

*最后更新: 2024-12-05*

